<%- model_class = GeneralInventory -%>
<%= javascript_include_tag 'jquery-1.12.0.min.js' %>
<%= javascript_include_tag 'jquery-ui.min.js' %>
<%= stylesheet_link_tag    'jquery-ui', media: 'all', 'data-turbolinks-track' => true %>

<div class="page-header">
  <h1><%=t '.title', :default => model_class.model_name.human.titleize %></h1>
</div>
<div class="row row-offcanvas row-offcanvas-right">

  <div class="col-xs-12 col-sm-10">
    <table id="generalInventory" class="table table-striped table-bordered" width="100%" cellspacing="0">
      <thead>
      <tr>
        <th>Item</th>
        <th>Item Identifier</th>
        <th>Lot Number</th>
        <th>Current Quantity</th>
        <th>Expiration Date</th>
        <th>Actions</th>
      </tr>
      </thead>

      <tbody>

        <% (@inventory || []).each do |item| %>
            <tr>
              <td><%= item.rxnconso.name.downcase.titleize %></td>
              <td><%= item.gn_identifier %></td>
              <td><%= item.lot_number %></td>
              <td><%= item.current_quantity %></td>
              <td><%= item.expiration_date.strftime('%b-%d-%Y') %></td>
              <td>

                <img src="/assets/edit.png" title="Edit Item">
                <img src="/assets/delete.png" title="Void Item">
              </td>
            </tr>
        <% end %>
      </tbody>
    </table>
  </div>


  <div class="col-xs-3 col-sm-2 sidebar-offcanvas" id="sidebar" >
    <div class="panel panel-info" >
      <div class="panel-heading">
        <h3 style=" font-size: 20px;" class="panel-title">Stock Summary</h3>
      </div>
      <div class="panel-body">
        <a href="#" class="list-group-item">
          <h4 class="list-group-item-heading">Items in Stock</h4>
          <p class="list-group-item-text"> <%= 0 %></p>
        </a>
        <a href="#" class="list-group-item">
          <h4 class="list-group-item-heading">Under Stocked Items</h4>
          <p class="list-group-item-text"> <%= 0 %></p>
        </a>
        <a href="#" class="list-group-item">
          <h4 class="list-group-item-heading">Items About to Expire</h4>
          <p class="list-group-item-text"> <%= 0 %></p>
        </a>
        <a href="#" class="list-group-item">
          <h4 class="list-group-item-heading">Expired Items</h4>
          <p class="list-group-item-text"> <%= 0 %></p>
        </a>
      </div>
    </div>

    <a href="#" class="btn btn-lg btn-primary"
       data-toggle="modal"
       data-target="#basicModal">Add Item</a>
  </div>
</div><!--/.sidebar-offcanvas-->
</div>

<div class="modal fade" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Add Item</h4>
      </div>
      <div class="modal-body">
        <%= form_for :general_inventory, :html => { :class => "form-horizontal general_inventory" }, :url => general_inventory_index_path  do |f| %>

            <% if (@general_inventory.blank? ? FALSE :  @general_inventory.errors.any?) %>
                <div id="error_expl" class="panel panel-danger">
                  <div class="panel-heading">
                    <h3 class="panel-title"><%= pluralize(@general_inventory.errors.count, "error") %> prohibited this general_inventory from being saved:</h3>
                  </div>
                  <div class="panel-body">
                    <ul>
                      <% (@general_inventory.blank? ? [] : @general_inventory.errors.full_messages).each do |msg| %>
                          <li><%= msg %></li>
                      <% end %>
                    </ul>
                  </div>
                </div>
            <% end %>

            <div class="form-group">
              <%= f.label :item, :class => 'control-label col-lg-4' %>
              <div class="col-lg-6">
                <input type="text" name="item" id="drugName" data-provide="typeahead" placeholder="Enter drug name" class ='form-control' >
              </div>
              <%#=f.error_span(:lot_number) %>
            </div>
            <div class="form-group">
              <%= f.label :lot_number, :class => 'control-label col-lg-4' %>
              <div class="col-lg-6">
                <%= f.text_field :lot_number, :class => 'form-control', :placeholder => 'Lot number' %>
              </div>
              <%#=f.error_span(:lot_number) %>
            </div>
            <div class="form-group">
              <%= f.label :expiration_date, :class => 'control-label col-lg-4' %>
              <div class="col-lg-6">
                <div class='input-group date' id='datetimepicker1'>
                  <input name="expiration_date" type='text' placeholder="Expiry date" class="form-control" />
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
              </div>
              <%#=f.error_span(:expiration_date) %>
            </div>
            <div class="form-group">
              <%= f.label :quantity_received, :class => 'control-label col-lg-4' %>
              <div class="col-lg-6">
                <%= f.text_field :quantity_received,:placeholder => "Quantity received" ,:class => 'form-control' %>
              </div>
              <%#=f.error_span(:current_stock) %>
            </div>

            <div class="form-group">
              <div class="col-lg-offset-7 col-lg-10">
                <%= f.submit "Save", :class => 'btn btn-success' %>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
              </div>
            </div>

        <% end %>

      </div>

    </div>
  </div>
</div>
<script type="text/javascript">

    // Styling the table with datatables library
    $(document).ready(function() {
        $('#generalInventory').DataTable({"bLengthChange": false});
    } );

    // Date picker activation
    $(function () {
        $('#datetimepicker1').datetimepicker({format: 'MMM DD, YYYY'});
    });

    var drugNames = ["Cardura 1 MG Oral Tablet","Cardura 2 MG Oral Tablet","Cardura 4 MG Oral Tablet","Zestril 5 MG Oral Tablet","Clozaril 25 MG Oral Tablet","Clozaril 100 MG Oral Tablet","Zofran 4 MG Oral Tablet","Zofran 8 MG Oral Tablet","Naprosyn 250 MG Oral Tablet","Naprosyn 500 MG Oral Tablet","Naprosyn 375 MG Oral Tablet","Topamax 50 MG Oral Tablet","Topamax 100 MG Oral Tablet","Topamax 200 MG Oral Tablet","Tenormin 50 MG Oral Tablet","acyclovir 400 MG Oral Tablet","acyclovir 800 MG Oral Tablet","albuterol 2 MG Oral Tablet","albuterol 4 MG Oral Tablet","dexamethasone 2 MG Oral Tablet","dexamethasone 4 MG Oral Tablet","dexamethasone 6 MG Oral Tablet","diazepam 10 MG Oral Tablet","diazepam 2 MG Oral Tablet","diazepam 5 MG Oral Tablet","fluconazole 100 MG Oral Tablet","fluconazole 150 MG Oral Tablet","fluconazole 200 MG Oral Tablet","fluconazole 50 MG Oral Tablet","ibuprofen 400 MG Oral Tablet","ibuprofen 600 MG Oral Tablet","ibuprofen 800 MG Oral Tablet","lovastatin 10 MG Oral Tablet","lovastatin 20 MG Oral Tablet","lovastatin 40 MG Oral Tablet","aspirin 500 MG Oral Tablet","aspirin 650 MG Oral Tablet","amoxicillin 500 MG Oral Tablet","amoxicillin 875 MG Oral Tablet","isoniazid 100 MG Oral Tablet"];
    $( "#drugName" ).autocomplete({
        source: "/suggestions",
        minLength: 2
    });


</script>
